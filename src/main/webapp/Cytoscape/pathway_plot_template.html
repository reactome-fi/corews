<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Reactome Pathway Enrichment Result Plot</title>
  <!-- Load plotly.js into the DOM. Use a fixed version to avoid potential bug. -->
	<script src='https://cdn.plot.ly/plotly-2.9.0.min.js'></script>
</head>
<body>
	<div id='pathway_plot_div'><!-- Plotly chart will be drawn inside this DIV --></div>
  <script>
      // An example of one trace. This should not be used.
//     var pathway_trace = {
//   x: ['A', 'C'],
//   y: [1, 1],
//   mode: 'markers',
//   type: 'scatter',
//   name: 'Team A',
//   text: ['A-1', 'A-2'],
// };

let data = $data;

let layout = {
  title: {
    text: "$title",
    font: {size: 13},
  },
  xaxis: {
    title: "Pathway",
    showticklabels: false,
    categoryorder: "array",
    categoryarray: $pathway_list,
  },
  yaxis: {
    title: "$y_title",
  },
  showlegend: true, // Always let this on
  font: {size: 12},
  shapes: [$lines]
};

let config = {responsive: true};

Plotly.newPlot('pathway_plot_div', data, layout, config);

let pathway_plot = document.getElementById('pathway_plot_div');

pathway_plot.on('plotly_restyle', function(data) {
  let plot_data = pathway_plot.data;
  if (plot_data.length < 2) // Nothing to plot
    return true;
  // Get the set of pathways shown
  let shown_pathways = new Set();
  for (let trace of plot_data) {
    // Default is undefined
    if (trace.visible === undefined || trace.visible === true) {
      trace.x.forEach(p => shown_pathways.add(p))
    }
  }
  for (let line of pathway_plot.layout.shapes) {
    line.visible = shown_pathways.has(line.x0)
  }
  Plotly.relayout(pathway_plot, pathway_plot.layout);
  return true; // Pass to the original handler
});

  </script>
</body>
</html>
